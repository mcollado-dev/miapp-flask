{% extends "base.html" %}

{% block content %}
<div class="container mt-5 fade-in">
    <h2 class="text-primary mb-4">Usuarios Registrados</h2>

    <div class="row">
        <div class="col-lg-8 mb-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <canvas id="graficoUsuarios" height="120"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-4 mb-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <canvas id="graficoRoles" height="120"></canvas>
                </div>
            </div>
        </div>
    </div>

    <h4 class="text-secondary mb-3 mt-5">Listado de usuarios</h4>
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Email</th>
                <th>Rol</th>
            </tr>
        </thead>
        <tbody>
            {% for u in usuarios %}
            <tr>
                <td>{{ u.id }}</td>
                <td>{{ u.nombre }}</td>
                <td>{{ u.email }}</td>
                <td>{{ u.rol }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx1 = document.getElementById('graficoUsuarios');
    new Chart(ctx1, {
        type: 'bar',
        data: {
            labels: {{ labels | tojson }},
            datasets: [{
                label: 'Usuarios registrados por mes',
                data: {{ data | tojson }},
                borderWidth: 1,
                backgroundColor: 'rgba(13, 110, 253, 0.6)',
                borderColor: 'rgba(13, 110, 253, 1)',
            }]
        },
        options: {
            scales: { y: { beginAtZero: true } },
            plugins: {
                legend: { display: true },
                title: {
                    display: true,
                    text: 'Estad√≠sticas de registro de usuarios',
                    color: '#0d6efd',
                    font: { size: 16 }
                }
            }
        }
    });

    const ctx2 = document.getElementById('graficoRoles');
    new Chart(ctx2, {
        type: 'doughnut',
        data: {
            labels: {{ roles.keys() | list | tojson }},
            datasets: [{
                data: {{ roles.values() | list | tojson }},
                backgroundColor: [
                    'rgba(25, 135, 84, 0.7)',
                    'rgba(255, 193, 7, 0.7)',
                    'rgba(220, 53, 69, 0.7)'
                ],
                borderColor: [
                    'rgba(25, 135, 84, 1)',
                    'rgba(255, 193, 7, 1)',
                    'rgba(220, 53, 69, 1)'
                ],
                borderWidth:

